dist: xenial
sudo: required
language:
- cpp
cache:
- apt
notifications:
  slack:
    secure: n8eup/26IVzzxg8wP55EL4wJvkEOAYMEt/ByltUtOAnrp+NipZiNPIheY062mXYRnc7iKI/7X7WVkSCcIlggalT06q1SoC1FBJn061oLz+s8eoXzUJhX08FCv3ZRVmNnbS45TCq9Xo3Oq+M/siPxeCwej8dOv61aqJJuLLsyRQpFPIyV5tw07ElZKWAMrzd4dIwzIiKJm0MaIyTpPcKKURX3wMzHSffgih+dm0wyNjtpL7jHpCvGTo7JAqQgDmMNoOWUquQw3cozbMEOWsl/4sU1U5716Dvnr8Ug9gqdehbYdwkq/6xDlsEGV/jUOy8810GCRADrR23FLm+He63PuWO2EUnwO4bHCqYRfQ+65qkRu1T29j63Z72sYx7lkQO4UVjad36M3mT7ipg86QzsC1ianXDD7mQC/XAw4INncrp1uBoROHiTUda3ri3JpmQTNcElmesfVnJnVrXXIwwxXchOptyTLDF+LaecQC5pKmQqK/NyWzestCWR/F8Yw8gp+AlVfV19dvnYScmxew+Y0wo855A7Sn/11MtdDzEdeTFXc35JvhFyT4sbi0AHpoZOatt+8/WfT2Lu9eoAnNjjYlNK7//OssZpF6uo+Mhw0isSnuJQpM9TNkrR1J9B+8IGvq7n2fKtkuh2tu5JgkeodRfMIj9sp2KvueQAl5sYkrI=

addons:
  apt:
    packages:
    - doxygen
matrix:
  include:
  - name: Xenial kinetic
    dist: xenial
    env: ROS_DISTRO=kinetic
env:
  global:
    ROS_DISTRO: kinetic
    ROS_CI_DESKTOP: "`lsb_release -cs`"
    CI_SOURCE_PATH: "$(pwd)"
    ROSINSTALL_FILE: "$CI_SOURCE_PATH/dependencies.rosinstall"
    CATKIN_OPTIONS: "$CI_SOURCE_PATH/catkin.options"
    ROS_PARALLEL_JOBS: "-j8 -l6"
    PYTHONPATH: "$PYTHONPATH:/usr/lib/python2.7/dist-packages:/usr/local/lib/python2.7/dist-packages"
before_install:
- sudo sh -c "echo \"deb http://packages.ros.org/ros/ubuntu $ROS_CI_DESKTOP main\"
  > /etc/apt/sources.list.d/ros-latest.list"
- sudo apt-key adv --keyserver hkp://ha.pool.sks-keyservers.net:80 --recv-key 421C365BD9FF1F717815A3895523BAEEB01FA116
- sudo apt-get update -qq
- sudo apt-get install dpkg
- sudo apt-get install -y python-catkin-pkg python-rosdep python-wstool ros-$ROS_DISTRO-ros-base
- sudo sh -c 'echo "deb http://packages.ros.org/ros/ubuntu `lsb_release -sc` main"
  > /etc/apt/sources.list.d/ros-latest.list'
- wget http://packages.ros.org/ros.key -O - | sudo apt-key add -
- source /opt/ros/$ROS_DISTRO/setup.bash
- sudo rosdep init
- rosdep update
- sudo apt-get install ros-kinetic-rosbash
- sudo apt-get install ros-kinetic-roslaunch
- pip install --user catkin_lint
- pip install --user catkin_tools_document
- sudo apt-get install python-catkin-tools
install:
- mkdir -p ~/catkin_ws/src
- cd ~/catkin_ws
- catkin init
- catkin build
- source devel/setup.bash
- cd ~/catkin_ws/src
- ln -s $CI_SOURCE_PATH .
before_script:
- cd ~/catkin_ws/src
- wstool init
- if [[ -f $ROSINSTALL_FILE ]] ; then wstool merge $ROSINSTALL_FILE ; fi
- wstool up
- cd ~/catkin_ws
- rosdep update
- rosdep install -y --from-paths src --ignore-src --rosdistro $ROS_DISTRO
- cd src
- cd ~/catkin_ws
script:
- source /opt/ros/$ROS_DISTRO/setup.bash
- cd ~/catkin_ws
- src/hardware-interface/build.sh
- src/hardware-interface/doc.sh
- pwd

deploy:
  provider: pages
  skip_cleanup: true
  local_dir: /home/travis/catkin_ws/docs/html
  github_token: "$GH_REPO_TOKEN"
  on:
    branch: refactor/use-catkin-build
